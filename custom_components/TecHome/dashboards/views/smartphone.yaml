kiosk_mode:
  non_admin_settings:
    hide_header: true
    ignore_disable_km: true
title: TecHome
path: home
icon: mdi:home
layout: vertical
cards:
  - type: vertical-stack ##chips
    cards:
      - type: custom:mushroom-chips-card
        chips:
          - type: conditional
            conditions:
              - condition: numeric_state
                entity: sensor.conteggio_luce
                above: 0
            chip:
              type: template
              icon: mdi:lamps-outline
              icon_color: amber
              content: "{{ states('sensor.luci_accese') }}"
              tap_action:
                action: navigate
                navigation_path: "#luci"
              double_tap_action:
                action: perform-action
                target:
                  label_id: luce
                perform_action: light.turn_off
          - type: conditional
            conditions:
              - condition: numeric_state
                entity: sensor.conteggio_luce
                below: 1
            chip:
              type: template
              icon: mdi:lamps-outline
              icon_color: disabled
              tap_action:
                action: none
          - type: conditional
            conditions:
              - condition: numeric_state
                entity: sensor.conteggio_tapparelle
                above: 0
            chip:
              type: template
              icon: mdi:blinds-horizontal
              icon_color: cyan
              content: "{{ states('sensor.tapparelle_aperte') }}"
              tap_action:
                action: navigate
                navigation_path: "#tapparelle"
              double_tap_action:
                action: perform-action
                target:
                  label_id: tapparella
                perform_action: cover.close_cover
          - type: conditional
            conditions:
              - condition: numeric_state
                entity: sensor.conteggio_tapparelle
                below: 1
            chip:
              type: template
              icon: mdi:blinds-horizontal
              icon_color: disabled
              tap_action:
                action: none
          - type: conditional
            conditions:
              - condition: numeric_state
                entity: sensor.conteggio_termostati
                above: 0
            chip:
              type: template
              icon: mdi:home-thermometer-outline
              icon_color: orange
              content: "{{ states('sensor.termostati_attivi') }}"
              tap_action:
                action: navigate
                navigation_path: "#termostati"
              double_tap_action:
                action: perform-action
                target:
                  label_id: termostato
                perform_action: climate.turn_off
          - type: conditional
            conditions:
              - condition: numeric_state
                entity: sensor.conteggio_termostati
                below: 1
            chip:
              type: template
              icon: mdi:home-thermometer-outline
              icon_color: disabled
              tap_action:
                action: none
          - type: template
            tap_action:
              action: navigate
              navigation_path: "#automazioni"
            icon: mdi:robot
            icon_color: green
            content: ""
          - type: conditional
            conditions:
              - condition: state
                entity: sensor.conteggio_sensori
                state: "1"
            chip:
              type: template
              tap_action:
                action: navigate
                navigation_path: "#sensori"
              icon: mdi:leak
              icon_color: blue
          - type: conditional
            conditions:
              - condition: state
                entity: sensor.conteggio_sensori
                state: "0"
            chip:
              type: template
              tap_action:
                action: none
              icon: mdi:leak
              icon_color: disabled
          - type: template
            tap_action:
              action: navigate
              navigation_path: /energy
            icon: mdi:home-lightning-bolt-outline
            icon_color: amber
        alignment: center
      - type: custom:mushroom-template-card ##messaggio benvenuto
        primary: >-
          {% set time = now().hour %}
          {% if (time >= 18) %} Buonasera, {{user}}!
          {% elif (time >= 12) %} Buon pomeriggio, {{user}}!
          {% elif (time >= 5) %} Buongiorno, {{user}}!
          {% else %} Ciao, {{user}}! {% endif %}
        icon: mdi:hand-wave
        icon_color: orange
        layout: horizontal
        secondary: >-
          Interna: {{ states('sensor.t_u_casa_temperature') }} Â°C |
          {{ states('sensor.t_u_casa_humidity') }} %
      - type: custom:swipe-card  ##meteo e alba
        parameters:
          effect: coverflow
          autoHeight: false
          autoplay:
            delay: 5000
        cards:
          - type: custom:clock-weather-card
            entity: weather.forecast_casa
            sun_entity: sun.sun
            temperature_sensor: sensor.outdoor_temm
            humidity_sensor: sensor.outdoor_humidity
            weather_icon_type: line
            animated_icon: true
            forecast_rows: 4
            time_pattern: HH:mm
            time_format: 24
            date_pattern: ccc d.MM.yy
            hide_today_section: false
            hide_forecast_section: false
            show_humidity: false
            hide_clock: true
            hide_date: true
            hourly_forecast: false
            use_browser_time: false
            time_zone: null
          - type: custom:horizon-card
      - square: true ##pulsanti
        type: grid
        cards:
          - show_name: false
            show_icon: true
            type: button
            tap_action:
              action: more-info
            icon: mdi:shield-lock-outline
            show_state: true
            hold_action:
              action: none
            entity: alarm_control_panel.allarme
          - type: custom:button-card
            entity: null
            triggers_update: sensor.conteggio_serratura
            color_type: icon
            icon: mdi:key-chain-variant
            tap_action:
              action: |
                [[[
                  const c = states['sensor.conteggio_serratura']?.state;
                  return (c === '0') ? 'none' : 'navigate';
                ]]]
              navigation_path: |
                [[[
                  const c = states['sensor.conteggio_serratura']?.state;
                  // se vuoi andare ad un anchor nella stessa vista:
                  return (c === '0') ? null : '#serratura';
                  // in alternativa, verso una vista specifica:
                  // return (c === '0') ? null : '/lovelace/home#serratura';
                ]]]
            styles:
              icon:
                - color: |
                    [[[
                      const c = states['sensor.conteggio_serratura']?.state;
                      return (c === '0') ? 'grey' : 'black';
                    ]]]
              card:
                - height: 100px
          - type: custom:button-card
            entity: null
            triggers_update: sensor.conteggio_telecamere
            color_type: icon
            icon: mdi:video-image
            tap_action:
              action: |
                [[[
                  const c = states['sensor.conteggio_telecamere']?.state;
                  return (c === '0') ? 'none' : 'navigate';
                ]]]
              navigation_path: |
                [[[
                  const c = states['sensor.conteggio_serratura']?.state;
                  // se vuoi andare ad un anchor nella stessa vista:
                  return (c === '0') ? null : '#telecamera';
                  // in alternativa, verso una vista specifica:
                  // return (c === '0') ? null : '/lovelace/home#serratura';
                ]]]
            styles:
              icon:
                - color: |
                    [[[
                      const c = states['sensor.contegggio_telecamera']?.state;
                      return (c === '0') ? 'grey' : 'black';
                    ]]]
              card:
                - height: 100px
          - show_name: false
            show_icon: true
            type: button
            tap_action:
              action: navigate
              navigation_path: "#server"
            icon: mdi:raspberry-pi
            hold_action:
              action: none
        columns: 4
      - type: custom:swipe-card
        parameters:
          effect: coverflow
        cards:
          - type: custom:swipe-card
            parameters:
              effect: coverflow
              autoHeight: false
              autoplay:
                delay: 10000
            cards:
              - type: custom:auto-entities
                card:
                  type: glance
                  title: Stato rapido
                filter:
                  include:
                    - options:
                        tap_action:
                          action: none
                      domain: binary_sensor
                      entity_id: /porta|finestra/
                      state: "on"
                    - options:
                        tap_action:
                          action: none
                      domain: binary_sensor
                      entity_id: /movimento/
                      state: "on"
                    - options:
                        tap_action:
                          action: none
                      domain: sensor
                      entity_id: /battery|batteria/
                      state: <20
                      label: entita
                  exclude:
                    - options: {}
                      state: "off"
                    - options: {}
                      state: unavailable
                sort:
                  method: name
              - type: logbook
                target:
                  entity_id: []
                  label_id: registro

#################################
####### Elementi nascosti #######
#################################

      - type: vertical-stack  ##porte
        cards:
          - type: vertical-stack
            cards:
              - square: true
                type: grid
                cards:
                  - type: vertical-stack ##pulsanti
                    cards:
                      - square: true
                        type: grid
                        cards:
                          - type: custom:button-card
                            entity: lock.smart_lock_door
                            aspect_ratio: 1
                            triggers_update: sensor.conteggio_porta
                            color_type: icon
                            icon: |
                              [[[
                                const c = states['sensor.conteggio_porta']?.state;
                                return (c === '1' && entity.state === 'unlocked')
                                  ? 'mdi:door-open'
                                  : 'mdi:door';
                              ]]]
                            tap_action:
                              action: |
                                [[[
                                  return (states['sensor.conteggio_porta']?.state === '0') ? 'null' : 'toggle';
                                ]]]
                            styles:
                              icon:
                                - color: |
                                    [[[
                                      const c = states['sensor.conteggio_porta']?.state;
                                      if (c === '0') return 'grey';                // disattivo
                                      return (entity.state === 'unlocked') ? 'green' : 'red';
                                    ]]]
                                - animation: |
                                    [[[
                                      const c = states['sensor.conteggio_porta']?.state;
                                      return (c === '1' && entity.state === 'unlocked')
                                        ? 'blink 1.4s ease-in-out infinite'
                                        : 'none';
                                    ]]]
                            extra_styles: |
                              @keyframes blink {
                                0%, 100% { opacity: 1; }
                                50% { opacity: 0.25; }
                              }
                          - type: custom:button-card
                            entity: button.portone
                            aspect_ratio: 1
                            triggers_update: sensor.conteggio_portone
                            color_type: icon
                            icon: mdi:key-chain-variant
                            tap_action:
                              action: |
                                [[[
                                  return (states['sensor.conteggio_portone']?.state === '0') ? 'null' : 'toggle';
                                ]]]
                            styles:
                              icon:
                                - color: |
                                    [[[
                                      const c = states['sensor.conteggio_portone']?.state;
                                      if (c === '0') return 'grey';                // disattivo
                                      else ('black');
                                    ]]]
                          - type: custom:button-card
                            entity: null
                            aspect_ratio: 1
                            triggers_update: sensor.conteggio_garage
                            color_type: icon
                            icon: |
                              [[[
                                const c = states['sensor.conteggio_garage']?.state;
                                return (c === '1' && entity.state === 'unlocked')
                                  ? 'mdi:garage-variant'
                                  : 'mdi:garage-variant';
                              ]]]
                            tap_action:
                              action: |
                                [[[
                                  return (states['sensor.conteggio_garage']?.state === '0') ? 'null' : 'toggle';
                                ]]]
                            styles:
                              icon:
                                - color: |
                                    [[[
                                      const c = states['sensor.conteggio_garage']?.state;
                                      if (c === '0') return 'grey';                // disattivo
                                      return (entity.state === 'unlocked') ? 'green' : 'red';
                                    ]]]
                                - animation: |
                                    [[[
                                      const c = states['sensor.conteggio_garage']?.state;
                                      return (c === '1' && entity.state === 'unlocked')
                                        ? 'blink 1.4s ease-in-out infinite'
                                        : 'none';
                                    ]]]
                            extra_styles: |
                              @keyframes blink {
                                0%, 100% { opacity: 1; }
                                50% { opacity: 0.25; }
                              }
                        columns: 2
                      - type: custom:bubble-card
                        card_type: pop-up
                        hash: "#serratura"
                        margin: 7px
                        width_desktop: 1000px
                        show_header: false
                        button_type: name
                        modules:
                          - TecHome
                          - "!default"
                        margin_top_mobile: 10px
                        margin_top_desktop: 10px
                        styles: ""
      - type: vertical-stack ## luci
        cards:
          - type: custom:auto-entities
            filter:
              include:
                - options:
                    type: custom:slider-button-card
                  label: luce
              exclude: []
            sort:
              reverse: false
              attribute: {}
              ip: false
              numeric: false
              ignore_case: false
            show_empty: true
          - type: custom:bubble-card
            card_type: pop-up
            hash: "#luci"
            margin: 7px
            width_desktop: 1000px
            show_header: false
            button_type: name
            modules:
              - TecHome
              - "!default"
      - type: vertical-stack ## tapparelle
        cards:
          - type: custom:auto-entities
            card:
              type: entities
            filter:
              include:
                - options:
                    type: custom:mushroom-cover-card
                    show_buttons_control: true
                  label: tapparella
              exclude: []
          - type: custom:bubble-card
            card_type: pop-up
            hash: "#tapparelle"
            margin: 7px
            width_desktop: 1000px
            show_header: false
            button_type: name
            modules:
              - TecHome
              - "!default"
      - type: vertical-stack  ## termostati
        cards:
          - type: custom:auto-entities
            filter:
              include:
                - options:
                    type: custom:mushroom-climate-card
                    show_temperature_control: true
                    fill_container: true
                    layout: vertical
                    primary_info: name
                    secondary_info: state
                  label: termostato
                  sort:
                    method: attribute
                    ignore_case: false
                    numeric: false
              exclude: []
            card: {}
          - type: custom:bubble-card
            card_type: pop-up
            hash: "#termostati"
            margin: 7px
            width_desktop: 1000px
            show_header: false
            button_type: name
            modules:
              - TecHome
              - "!default"
      - type: vertical-stack ##automazioni
        cards:
          - type: custom:scheduler-card
            include:
              - alarm_control_panel
              - climate
              - cover
              - light
            exclude: []
          - type: custom:bubble-card
            card_type: pop-up
            hash: "#automazioni"
            margin: 7px
            width_desktop: 1000px
            show_header: false
            button_type: name
            modules:
              - TecHome
              - "!default"
      - type: vertical-stack ##server
        cards:
          - type: picture
            image: >-
              https://www.pi-shop.ch/media/catalog/product/cache/1/image/363x/040ec09b1e35df139433887a97daa66f/t/h/thumbnail_11__2.jpg
            tap_action:
              action: none
            hold_action:
              action: none
          - type: custom:mushroom-update-card
            entity: update.home_assistant_supervisor_update
            fill_container: true
            layout: horizontal
            show_buttons_control: false
            collapsible_controls: false
            icon: mdi:package
          - type: custom:mushroom-update-card
            entity: update.home_assistant_core_update
            fill_container: true
            layout: horizontal
            icon: mdi:package
          - type: custom:mushroom-update-card
            entity: update.home_assistant_operating_system_update
            fill_container: true
            layout: horizontal
            icon: mdi:package
          - type: tile
            vertical: false
            state_content: state
            grid_options:
              columns: 12
              rows: 1
            entity: sensor.uptime
            name: "Tempo di accensione:"
            features_position: bottom
          - type: horizontal-stack
            cards:
              - type: entity
                entity: binary_sensor.rpi_power_status
          - square: true
            type: grid
            cards:
              - graph: line
                type: sensor
                detail: 1
                entity: sensor.speedtest_scarica
                name: "Download "
              - graph: line
                type: sensor
                detail: 1
                entity: sensor.speedtest_carica
                name: Upload
              - graph: line
                type: sensor
                detail: 1
                entity: sensor.speedtest_ping
                name: Ping
            title: Speedtest
            columns: 2
          - type: custom:bubble-card
            card_type: pop-up
            hash: "#server"
            margin: 7px
            width_desktop: 1000px
            show_header: false
            button_type: name
            modules:
              - TecHome
              - "!default"
      - type: vertical-stack ##telecamera
        cards:
          - type: custom:advanced-camera-card
            cameras:
              - camera_entity: camera.telecamera_1
            performance:
              features:
                card_loading_indicator: true
                animated_progress_indicator: true
            live:
              preload: false
            menu:
              style: hover
              buttons:
                expand:
                  enabled: false
                image:
                  enabled: false
                play:
                  enabled: false
                ptz_controls:
                  enabled: false
                recordings:
                  enabled: false
                timeline:
                  enabled: false
                clips:
                  enabled: true
                mute:
                  enabled: false
                iris:
                  enabled: false
                substreams:
                  enabled: false
            view:
              triggers:
                show_trigger_status: false
            profiles:
              - casting
            folders: []
          - type: entities
            entities:
              - entity: siren.sala_sirena
              - entity: binary_sensor.sala_persona
                name: Rilevamento persona
          - type: custom:bubble-card
            card_type: pop-up
            hash: "#telecamera"
            margin: 7px
            width_desktop: 1000px
            show_header: false
            button_type: name
            modules:
              - TecHome
              - "!default"
      - type: vertical-stack ##sensori
        cards:
          - type: custom:auto-entities
            card:
              type: entities
            filter:
              include:
                - options: {}
                  label: sensori
                  sort:
                    numeric: false
                    reverse: true
                    ignore_case: false
                    ip: false
                    method: friendly_name
              exclude: []
          - type: custom:bubble-card
            card_type: pop-up
            hash: "#sensori"
            margin: 7px
            width_desktop: 1000px
            show_header: false
            button_type: name
            modules:
              - TecHome
              - "!default"